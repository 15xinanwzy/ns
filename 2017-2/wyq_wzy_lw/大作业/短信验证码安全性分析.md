# 短信验证码安全性分析

### 短信验证的预设
*  认为用户的手机卡是不会轻易丢失和被窃取的，和用户绑定更紧密。（相对于各种脱库事件，密码泄露的概率要大于丢失手机的概率，且手机丢失有补救措施即可以立即去运营商挂失补卡，而密码泄露无可挽回）

*  认为有手机号可以做二次验证的用户是真实用户（因此手机验证码通常也会在要求比较高的场合被用来作反垃圾注册，并且能获得更多用户的真实信息）

* 认为运营商维护的通讯信道比其他的都更安全（此预设基本上是可信的），但是在智能手机普及的大环境下各类短信木马此起彼伏，补卡攻击和无线电监听这些一直存在的问题也被关注和利用，因此短信验证的安全性就开始出现了问题。

即手机验证码是建立在将手机假设为很重要的位置和很安全的前提下的解决方案。

### 短信验证的威胁
1. 非手机持有者接触

   如手机的丢失、窃取或在未设置密码时被人接触等。

2. 智能手机平台上的短信木马。

   这种木马的作用之前广泛用于支付宝诈骗，不法分子诱骗受害者通过二维码下载安装木马，随后重置受害者的支付宝、淘宝账户盗取钱财。因为之前支付宝的重置密码验证只通过短信验证码，木马在后台可以轻易窃取并转发给不法分子，实现对受害者的账号重置。这类木马编写简单，已经形成了非常完整的产业链：从制马人员到售马、租马，到实施钓鱼、欺骗、洗号、转移钱财。在智能手机的年代，由于OS开放了短信操作和拦截的接口（Android直接提供，iOS需要越狱），对于一个安装了支付类App的智能手机且绑定账户的SIM卡也安装在同一个手机的情况（绝大部分情况下是这样），短信验证事实上已经退化成了单因子验证，只要智能手机被安装了木马，这些验证体系就会全线崩溃，攻击者甚至可以只通过钓鱼wifi全部截取登陆密码、支付密码和短信验证。

3. 补卡攻击、克隆攻击。

  短信验证码事实上是基于手机号（SIM卡/运营商服务）而不是手机设备。因此如果能办一张和受害者相同的手机号（卡），就可以达到克隆的目的——接受受害者的验证码，重置各种账号。参考安卓系统手机绑定银行卡易成黑客“提款卡”，这里的薄弱环节就在运营商，部分地区的运营商对补卡人员身份验证不严导致出现了补卡攻击。在早些年SIM卡构造简单的时候甚至还能直接去克隆一张卡出来。

4. 无线电监听。

   这里主要包括GSM监听，包括监听空中短信，直接获取短信内容（此方式成本和范围有限制，相对1、2来说用在真正犯罪的情况下比较少。

### 解决方案
1. 用户自身提高安全防范意识

   * 密码设置

   例如设置手机锁屏码是必须的步骤，防止手机丢失后被直接打开使用，增加犯罪成本。另外还可以给SIM卡设置PIN码（静态密码设置一定要复杂），PIN码初始一般是1234，要注意修改。SIM卡插入任何手机中，只有输入正确的PIN码才能使用，输错3次之后需要验证PUK码，PUK如果再次输错SIM卡就会报废。手机被偷之后请一直呼叫，呼叫至没电或者关机。

   在假定设置了不会被轻易破解的锁屏密码的情况下，针对如下情况：
      * 短信验证：攻击者可能破解失败锁屏密码后就直接取出SIM卡，这种情况下手机丢失后应立即去营业厅或者电话挂失号码。

      * OTP类：这些基于App的验证相对来说比较可靠，但为了提高安全性也需要吊销，以重新生成种子。

   *  遭遇“干扰信息”仔细甄别

      每个人手机上，可能都会出现过各种的干扰信息，那么如果在我们风险意识并不是很强的情况下，很容易被这种干扰信息所误导，就会产生后续的一系列的损失。

   * 手机离奇“瘫痪” 紧急“挂失”当先

    另外，如果手机通讯出现瘫痪，一定要马上查清故障原因。如非手机本身或信号故障，要立刻挂失手机卡，并及时冻结第三方支付和银行账户，避免攻击者趁用户处于"信息孤岛"时，冒名顶替机主身份窃取账户。

   * 短信验证码 不能告诉任何人！

    最最重要的是：短信验证码不要告诉任何人！电信运营商和提供相关服务的企业只会将短信验证码下发给用户，绝对不会要求用户通过短信或电话进行所谓“回复验证码”的操作。

   * 不要安装来路不明的应用

    建议只安装手机品牌商店中的应用（起码安全性要高一些）

2. 系统开放度

  短信木马的情况有很大部分其实是反木马和系统开放度的问题，Android在4.4之后已经收紧了短信权限，目前4.4及之后版本普及之后情况有一定好转。

3. 运营商维护的安全信道

  补卡攻击和克隆攻击依赖于运营商的各大营业厅加强安全意识，随着安全性意识的增强，目前在营业厅的补卡行为盘查的较为严格，补卡和克隆攻击情况有所缓解。

  无线电监听情况可以考虑使用CDMA、3G、4G等更安全的信号通道，但目前也有降维攻击，强制将用户信号降为（2G）GSM之后进行监听。这种攻击的防御主要是使用非GSM制式的通讯服务，等待GSM退出历史舞台。

### 总结
短信并不是最好的二次验证方法，但却是成本最低最容易实现的验证方法：用户绑定性较强，不需要额外设备，用户广泛拥有，校验成本极低。在没有设计缺陷的情况下，在密码认证之外添加短信认证是同时使用了第一类和第二类认证，也即强认证。在密码设置合理（严格来说必须用随机数，或大小写、数字、特殊字符混合的便于记忆型数据）、手机短信验证码系统可靠（在不被人复制窃听）的情况下，安全性是有充分保证的。即使是两种认证方式终有任何一种被破坏，面对一般的威胁时，综合考虑成本和适用性的情况下，短信验证码在目前来说安全性不算很低。

。
