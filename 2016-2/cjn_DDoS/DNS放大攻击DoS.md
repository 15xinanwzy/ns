#反射型/放大器型DoS/DDoS攻击的原理与实验##DNS#### 1.原理攻击者向一个开放DNS解析器发送一个DNS名称查找请求，地址却写为靶机的地址，DNS解析器收到请求之后就会发送DNS相应记录，就会发送给靶机。因为响应的大小通常明显大于请求，攻击者可以放大针对靶机的交通量，通过利用僵尸网络执行额外的欺骗DNS查询，攻击者花费很小的工夫就可以获得大量的通信量。#### 2.实验首先三台虚拟机分别给它们分配ip，User为192.168.0.1，DNS Server为192.168.0.2，Attacker为10.233.233.1****DNS Server的配置：修改/etc/bind/named.conf.options文件，增加dump.db作为DNS缓存的文件，使用chmod提高dump.db的文件权限(777)  设置DNS Server的本地zone为example.com和192.168.0.x两个域  重启bind9服务****User的配置：设置User的默认DNS服务器为192.168.0.2  Attacker的配置：设置Attacker的默认DNS服务器为192.168.0.2****三台机器的外部网关设置为NAT的虚拟网卡网关设置为10.233.233.2****修改本地host文件  修改User本地的Host文件，增加www.example.com一项，定向为127.0.0.1****####欺骗回复User的DNS查询  当User向DNS Server发送DNS查询的时候，Attacker监听了这个DNS查询请求，然后在DNS Server回复正确的DNS Response之前，先回复一个伪造欺骗的DNS Response给User，从而达到了DNS欺骗的效果。****####Local DNS Attack  当DNS Server对Root DNS Server询问的时候，Attacker监听了DNS Server对外发出的DNS Query，伪造了一个DNS Response给DNS Server，从而让DNS Server中有了DNS Cache，且设置的ttl很长，因此就能够达到高效的DNS Attack。****####Remote DNS Attack  由于不在同一局域网内，Attacker不能监听DNS Server的DNS Query包，所以采用的方法是对transaction ID进行全枚举，而且必须在真正的DNS Response到来之前枚举成功这个transaction ID，所以就不用枚举UDP port这个变量。但是ns.dnslabattacker.net不是一个合法的域名，因此DNS Server需要对它进行验证，否则不会将它保存在DNS Cache中，所以需要在Attacker机器中配置DNS服务，将ns.dnslabattacker.net作为该DNS的本地zone就好。****#### 3.如何防御保证拥有足够的带宽承受小规模的洪水般的攻击。一个单一的T1线路对于重要的互联网连接是不够的，因为任何恶意的脚本少年都可以消耗掉你的带宽。  保证手边有能够与你的ISP随时取得联系的应急电话号码。这样，一旦发生这种攻击，可以马上与ISP联系，让他们在上游过滤掉这种攻击。要识别这种攻击，查看包含DNS回复的大量通讯(源UDP端口53)，特别是要查看那些拥有大量DNS记录的端口。一些ISP已经在其整个网络上部署了传感器以便检测各种类型的早期大量通讯。。  为了帮助阻止恶意人员使用DNS服务器作为一个实施这种DNS放大攻击的代理，要保证可以从外部访问的DNS服务器仅为你自己的网络执行循环查询，不为任何互联网上的地址进行这种查询。大多数主要DNS服务器拥有限制循环查询的能力，仅接受某些网络的查询。通过阻止利用循环查询装载大型有害的DNS记录，就可以防止服务器成为这个问题的一部分。