## 从它开始 我们慢慢谈
### 手机短信接收验证码的实现原理

* **A  获得验证码:**

	* 找到相关的表。
	* 用什么发送,post，get ,ajax（首选）
	* post之前要js先判断是手机号码11位，并且全部都是数字，或者用正则也行。
	* 用ajax发送数据data,要对数据进行检验，过滤有效数据valid 
	* insert前要先判断这手机是否验证过了,已经验证过就return false;没验证过则把随机生成的6位验证码insert 数据库表中。
	* 通过提供给你api写好调用，把验证码跟msg通过ajax返回值发送给客户，并用js做一个倒计时计数器.

* **B  接收验证码 提交表单：**

	* 接收post过来数据，把验证码跟跟刚才插入数据库中的6位key进行比较。如果相等，则说明是最后一次发送的验证码才有效。
	* 对数据库insert 操作.最少要做个认证tag标志.

### 短信验证码的地位
我们这一代，几乎没有人不知道短信验证码的，就像我在上上篇文档中提到的，很多常用的软件都是用的短信验证码。短信虽然并不是最好的二次验证方法，但却是成本最低最容易实现的也基本靠谱的：用户绑定性较强，不需要额外设备，用户广泛拥有，校验成本极低。也正是因为此，本次captcha的探究，我选择了从最常见的它开始(●'◡'●)

### 短信验证的预设是
1. 认为用户的手机卡是不会轻易丢失和被窃取的，和用户绑定更紧密
2. 认为有手机号可以做二次验证的用户是真实用户
3. 认为运营商维护的通讯信道比其他的都更安全

 
### 所面临的主要威胁
以上的预设基本上是很靠谱的，但是道高一尺魔高一丈，在如今智能手机普及的大环境下，有越来越多的黑客利用各种漏洞对其进行攻击，况且短信验证码作为安全的中流砥柱，又有其突出的弱点：明文发送，在通信途中被拦截和转发即失去了安全性。我在乌云君的专栏中找到了这个图，里面有hack验证码的多种方式，其不安全性可见一斑。

![Image text](https://github.com/Zhaojytt/ns/blob/master/2016-2/zjy/img_folder/22.jpg)

其中主要面对的有：
 
* **智能手机平台上的短信木马（最普遍）**

	手机木马是2014年春天开始崛起的，主要以安卓平台为主。安卓平台的发行应用的渠道比较混乱，又可以自行下载APK文件进行安装，这就给了黑客种植木马的好机会。木马是怎么进入用户的手机呢？最重要的一个方式就是钓鱼短信。现在我们都习惯了通过短信来接收诸如联通、银行、机票的等等通知。这种对短信通知的信任又催生了钓鱼短信的大发展。而短信最要命的一点是单边验证，发的人能确保接收的人就是这个手机号，收的人说实话验证不了到底是谁发的短信。有各种修改显示号码的黑客软件，能发出显示成银行电信等服务号码的短信，内容就是各种官方口气的通知，诱使我们用户去点击链接。用户点进去后会有一个APK下载来提示安装，安装后手机就中了木马。木马的传播是非常迅速的，中了木马的手机，会悄悄地给通讯录里面的人发送钓鱼短信，还会智能地按照通讯录里面的记录称呼，给儿子的短信可能就是儿子的小名，短信的内容大多是什么我最近拍了些照片，点击链接就可以看到这类的。这就大大增强了钓鱼短信的可信度，促使更多人中招。中招的手机继续向通讯录发短信扩散木马，这样一传十，十传百，木马迅速就传播开了。木马种植到手机里面，就隐藏起来。它会专门监视各个支付平台的短信验证码和和银行的扣款通知短信，对短信验证码木马会自动转发到骗子控制的设备上，对于银行扣款的通知短信，木马悄悄删掉。这样用户根本感知不到支付行为的发生。骗子利用钓鱼网站收集过来的客户信息进行诈骗，验证中需要的支付密码的，骗子就用木马转发来的短信验证码填写就可以了。这样一来，短信验证码在安全上的防护作用就被彻底地破坏了。
 

* 补卡攻击（较少）

	短信验证码是基于手机号（SIM卡/运营商服务）而不是手机设备，所以只要有一张和受害者相同的手机卡，就能自然地接受受害者的验证码，进行重置账号等各项操作。这种攻击的主要问题出在运营商身上，一些中小城市的运营商对补卡人员身份验证不严，让攻击者有机可乘。

* 无线电监听（几乎没有）
	
	这里主要包括GSM监听，监听空中短信，直接获取短信内容，但这个成本和范围有限制,感觉不太值得(捂脸笑哭)


### 防范威胁的安全措施

* 从用户角度来说，一定要注意
	* 各类应用对读取短信有关的权限的说明
	* 不要直接点击短信里面的链接以防被钓鱼。
	* 对莫名其妙出来的的安装文件千万不要安装
	* 在手机上面安装杀毒软件，定期对病毒和木马进行查杀。
	* 时刻监控账户情况
 
* 从社会的角度来说，应该
	* 企业应充分意识到短信验证码的安全性缺陷，不能把各类安全业务如修改密码和改绑手机证书的最后条件全用短信验证码，在多种验证方式来保护用户的安全，如安全问题、指纹识别、人脸识别等互为补充来进行身份验证的。
	* 各家支付机构和安全机构要同心合力，把木马和钓鱼网站信息共享，配合公安机关抓捕相关人员，从根本上确保用户安全。
 

### 结语
总而言之，短信验证码在实现人机验证的方式中举足轻重，使用普遍。但在手机木马的猖狂进攻下，短信验证码的不足也暴露地越来越明显，可以预见到，在未来数年中，短信验证码在人机验证中还将扮演着一定的角色，但是越来越多的身份验证手段会更加紧密地配合，共同防护营造安全环境！


###学习资料
[https://www.douban.com/note/518962387/]
[http://www.cnblogs.com/hnbiao/p/4569278.html]
[https://zhuanlan.zhihu.com/p/19974019?columnSlug=wooyun]
[https://www.zhihu.com/question/24173904]
[http://news.mydrivers.com/1/310/310890.html]
[http://cn.bing.com/search?q=%E7%9F%AD%E4%BF%A1%E9%AA%8C%E8%AF%81%E7%A0%81%E5%AE%89%E5%85%A8%E6%80%A7&go=%E6%90%9C%E7%B4%A2&qs=n&form=QBRE&sp=-1&pq=%E7%9F%AD%E4%BF%A1%E9%AA%8C%E8%AF%81%E7%A0%81%E5%AE%89%E5%85%A8%E6%80%A7&sc=0-8&sk=&cvid=D13036E36C4B4C2DA56175B694A656FA]
> 一篇跨越了一个月的文档[捂脸]
